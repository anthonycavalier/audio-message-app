<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Detector</title>
</head>
<body>
    <h1>Listen for Song and Decode Message</h1>
    <button id="start-listening">Start Listening</button>
    <p id="status"></p>
    <p id="decoded-message"></p>

    <script>
        document.getElementById('start-listening').addEventListener('click', listenForSong);

        async function listenForSong() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const microphone = audioContext.createMediaStreamSource(stream);
            const analyser = audioContext.createAnalyser();

            microphone.connect(analyser);
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            const targetFrequency = 106.5; // Example frequency for Daft Punk song

            document.getElementById('status').innerText = "Listening...";

            function detectAudio() {
                analyser.getByteFrequencyData(dataArray);
                const detectedFrequency = getDetectedFrequency(dataArray);
                if (detectedFrequency) {
                    document.getElementById('status').innerText = `Detected Frequency: ${detectedFrequency} Hz`;
                    if (isTargetSong(detectedFrequency)) {
                        handleDetectedSignal();
                    }
                }
                requestAnimationFrame(detectAudio);
            }

            detectAudio();
        }

        function getDetectedFrequency(dataArray) {
            const threshold = 200; // Detection threshold
            for (let i = 0; i < dataArray.length; i++) {
                if (dataArray[i] > threshold) {
                    const frequency = i * (audioContext.sampleRate / dataArray.length); // Calculate frequency
                    return frequency; // Return detected frequency in Hz
                }
            }
            return null;
        }

        function isTargetSong(frequency) {
            // Check if detected frequency matches the target frequency for the song
            return frequency > 105.0 && frequency < 108.0; // Example range for simplicity
        }

        function handleDetectedSignal() {
            document.getElementById('status').innerText = "Song detected! Decoding message...";
            const encodedMessage = "72,101,108,108,111"; // Placeholder for received encoded message
            const decodedMessage = decodeMessage(encodedMessage);
            document.getElementById('decoded-message').innerText = `Decoded Message: ${decodedMessage}`;
        }

        function decodeMessage(encodedMessage) {
            // Simple decoding function
            return encodedMessage.split(',').map(code => String.fromCharCode(code)).join('');
        }
    </script>
</body>
</html>
