<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Detector</title>
</head>
<body>
    <h1>Listen for Song and Decode Message</h1>
    <button id="start-listening">Start Listening</button>
    <p id="status"></p>
    <p id="decoded-message"></p>

    <script>
        document.getElementById('start-listening').addEventListener('click', listenForSong);

        async function listenForSong() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const microphone = audioContext.createMediaStreamSource(stream);
            const analyser = audioContext.createAnalyser();

            microphone.connect(analyser);
            const dataArray = new Uint8Array(analyser.frequencyBinCount);
            document.getElementById('status').innerText = "Listening...";

            function detectAudio() {
                analyser.getByteFrequencyData(dataArray);
                const detectedFrequencies = getDetectedFrequencies(dataArray);
                if (detectedFrequencies.length > 0) {
                    document.getElementById('status').innerText = `Detected Frequencies: ${detectedFrequencies.join(', ')} Hz`;
                    const decodedMessage = decodeMessage(detectedFrequencies);
                    if (decodedMessage) {
                        handleDetectedSignal(decodedMessage);
                    }
                }
                requestAnimationFrame(detectAudio);
            }

            detectAudio();
        }

        function getDetectedFrequencies(dataArray) {
            const threshold = 200; // Detection threshold
            const detectedFrequencies = [];
            for (let i = 0; i < dataArray.length; i++) {
                if (dataArray[i] > threshold) {
                    const frequency = i * (audioContext.sampleRate / dataArray.length); // Calculate frequency
                    detectedFrequencies.push(Math.round(frequency)); // Round to the nearest whole number
                }
            }
            return detectedFrequencies;
        }

        function decodeMessage(frequencies) {
            // Decode frequencies into message
            const messageChars = frequencies.map(freq => String.fromCharCode(freq));
            return messageChars.join('');
        }

        function handleDetectedSignal(decodedMessage) {
            document.getElementById('status').innerText = "Signal detected! Decoding message...";
            document.getElementById('decoded-message').innerText = `Decoded Message: ${decodedMessage}`;
        }
    </script>
</body>
</html>
